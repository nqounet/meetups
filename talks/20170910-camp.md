# Have you done Elixir?
##### Hackathon 2017
##### Nobutaka Wakabayashi

---

## WEB+DB PRESS Vol.88

æ¬¡ä¸–ä»£è¨€èª Elixir ã§é«˜ä¿¡é ¼ãª Web é–‹ç™º

___

æœ€åˆã®ã‚µãƒ³ãƒ—ãƒ«

___

å‹•ãã¾ã›ã‚“ã§ã—ãŸ

___

## ğŸ˜¦

___

ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚‚æ„å‘³ä¸æ˜

___

2015å¹´8æœˆç™ºè¡Œ

___

2å¹´ã‚‚å‰ãªã®ã§ä»•æ–¹ãªã„

___

ãƒ€ãƒ¡å…ƒã§è‰²ã€…ã‚„ã£ã¦ã¿ãŸ

___

## ğŸ˜©

---

ã›ã‚ã¦APIã®è¿”ã‚Šå€¤ã‚’è¦‹ã¦ã¿ã‚ˆã†

___

http://api.openweathermap.org/data/2.5/weather?q=Tokyo,jp

___

```
{
  "cod": 401,
  "message": "Invalid API key. Please see http://openweathermap.org/faq#error401 for more info."
}
```

___

## ğŸ˜¦

___

ãã‚‚ãã‚‚ç™»éŒ²ãŒå¿…è¦ãªAPIã§ã—ãŸ

---

## OpenWeatherMap

https://openweathermap.org/

___

API key å–ã‚Šã¾ã—ãŸ

___

URL ã‚’å¤‰æ›´

___

http://api.openweathermap.org/data/2.5/weather?q=Fukuoka,jp&appid=4c73594aa8bdf74252d9a7fa56a4f514

ï¼ˆã¤ã„ã§ã« Fukuoka ã«å¤‰æ›´ï¼‰

___

å‹•ãã¾ã—ãŸ

___

## ğŸ˜†

---

# ç›®æ¨™é”æˆï¼ï¼

---

## ã‚³ãƒãƒ³ãƒ‰ç¾¤

___

### scaffold

```
mix new weather_client
```

- ã“ã†ã„ã†ã®ã¯ä¾¿åˆ©ã‚ˆã­
- -> `minil new`

___

### ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªå–å¾—

```
mix deps.get
```

- å®Ÿéš›ã«ã¯ã“ã“ã‚‚ãƒãƒãƒªãƒã‚¤ãƒ³ãƒˆ
- ã“ã®ã¸ã‚“ã®è¨˜è¿°ãŒã¾ã£ãŸããªã‹ã£ãŸ
- ã¨ã„ã†ã‹ã€ãã‚‚ãã‚‚ `mix` ã‚’ä½¿ã†ã¨ã‹ã‚‚æ›¸ã„ã¦ãªã‹ã£ãŸ
- å¸¸è­˜æ€–ã„
- -> `carton install`

___

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’æ¢ã™

```
mix hex.search holiday
```

- ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ç®¡ç†ã£ã½ã„

___

### ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’èª¿ã¹ã‚‹

```
mix hex.info holiday_jp
```

- ï¼ˆç•¥ï¼‰

___

### ãƒ†ã‚¹ãƒˆ

```
mix test
```

- æ›¸ã„ã¦ãªã„ã‘ã©
- scaffold ã§ã§ããŸã‚„ã¤ãŒã‚ã‚‹

___

### å®Ÿè¡Œ

```
mix
```

- ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚„å®Ÿè¡Œãªã©ã‚’å…¨éƒ¨ã‚„ã£ã¦ãã‚Œã‚‹
- å¤‰æ›´ãŒãªã‘ã‚Œã°ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã—ãªã„

___

### REPL ã‚’èµ·å‹•ã™ã‚‹

```
iex -S mix
```

___

### REPL ã§å‹•ã‹ã™

```
iex(1)> WeatherClient.get
```

___

ã ã„ãŸã„ãã‚“ãªæ„Ÿã˜

---

# Perl ã§ã‚‚ REPL

___

https://metacpan.org/pod/Reply

```
reply
```

___

ã‚³ãƒ¼ãƒ‰ã®å®Ÿè¡Œä¸­ã§ã‚‚ REPL ã‚’èµ·å‹•ã§ãã‚‹

https://metacpan.org/pod/Pry

```
use Pry;
my @peoples = qw(Alice Bob Chris);
pry();
print "@peoples";
```

___

ã ã„ãŸã„ãã‚“ãªæ„Ÿã˜

---

## ã•ã¦

---

## æœ¬ç•ªã¯ã“ã‚Œã‹ã‚‰ã 

---

# ä¸¦è¡Œå‡¦ç†

___

## Elixir ã®çœŸéª¨é ‚

___

### å‡ºå…¸

https://employment.en-japan.com/engineerhub/entry/2017/06/19/110000

<small>æŒ‘æˆ¦ï¼ Elixirã«ã‚ˆã‚‹ä¸¦è¡Œãƒ»åˆ†æ•£ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ä½œã‚Šæ–¹ã€ç¬¬äºŒè¨€èªã¨ã—ã¦ã®Elixirã€‘ - ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢Hubï½œè‹¥æ‰‹Webã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ã®ã‚­ãƒ£ãƒªã‚¢ã‚’è€ƒãˆã‚‹ï¼</small>

___

### ä»¥ä¸‹ã®ã‚ˆã†ãªé–¢æ•°ã‚’ç”¨æ„ã™ã‚‹

- 1,000ä»¥ä¸‹ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆ
- nãƒŸãƒªç§’ã‚¹ãƒªãƒ¼ãƒ—ã—ã¦çµæœã‚’æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™

___

1,000ä»¥ä¸‹ã®ãƒ©ãƒ³ãƒ€ãƒ ãªæ•°å­—ã‚’ç”Ÿæˆ
```
def random do
  :rand.uniform 1000
end
```

___

nãƒŸãƒªç§’ã‚¹ãƒªãƒ¼ãƒ—ã—ã¦çµæœã‚’æ–‡å­—åˆ—ã¨ã—ã¦è¿”ã™
```
def sleep(n) do
  IO.puts "--- sleep(#{inspect(n)}) begin ---"
  :timer.sleep n
  IO.puts "--- sleep(#{inspect(n)}) end ---"
  "result-sleep(#{inspect n})"
end
```

___

### sequential

```
def exec_seq do
  IO.puts "=== é€æ¬¡å®Ÿè¡Œé–‹å§‹ ==="
  result =
    1..100
    |> Enum.map(fn _ -> random() end)
    |> Enum.map(fn t -> sleep(t) end)
  IO.puts "=== é€æ¬¡å®Ÿè¡Œçµæœ ==="
  result
end
```

___

### concurrent

```
def exec_con do
  IO.puts "=== ä¸¦è¡Œå®Ÿè¡Œé–‹å§‹ ==="
  result =
    1..100
    |> Enum.map(fn _ -> random() end)
    |> Enum.map(fn t -> Task.async(Worker, :sleep, [t]) end)
    |> Enum.map(fn d -> Task.await(d) end)
  IO.puts "=== ä¸¦è¡Œå®Ÿè¡Œçµæœ ==="
  result
end
```

___

## Demo

```
iex -S mix
Worker.exec_seq
Worker.exec_con
```

---

# ã“ã“ã¾ã§ã®æ„Ÿæƒ³

---

## |>

___

### ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ¼”ç®—å­

https://elixirschool.com/jp/lessons/basics/pipe-operator/

___

### ã“ã‚Œã‚’
```
foo( bar( baz( func( new_func() ) ) ) )
```

___

### ã“ã†æ›¸ã‘ã‚‹
```
new_func() |> func() |> baz() |> bar() |> foo()
```

___

ã ã„ãŸã„ãã‚“ãªæ„Ÿã˜

---

## xxx/1 ã¨ã‹ xxx/2

___

### iex ã® help
```
There are many other helpers available, here are some examples:

  â€¢ b/1            - prints callbacks info and docs for a given module
  â€¢ c/1            - compiles a file into the current directory
  â€¢ c/2            - compiles a file to the given path
  â€¢ cd/1           - changes the current directory
  â€¢ clear/0        - clears the screen
...
```

___

åå‰ãŒåŒã˜ã§ã‚‚ã€å¼•æ•°ã®æ•°ãŒå¤‰ã‚ã‚‹ã¨åˆ¥ã®é–¢æ•°ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹

___

### åå‰ãŒåŒã˜ã§ã‚‚ã€å¼•æ•°ã®æ•°ãŒå¤‰ã‚ã‚‹ã¨åˆ¥ã®é–¢æ•°ã¨ã—ã¦æ‰±ã‚ã‚Œã‚‹

___

https://elixirschool.com/jp/lessons/basics/functions/#é–¢æ•°ã®å‘½åã¨ã‚¢ãƒªãƒ†ã‚£

___

ã ã„ãŸã„ãã‚“ãªæ„Ÿã˜

---

## ã—ã£ãã‚Šæ¥ã¦ãªã„

___

### ã‚¢ãƒˆãƒ 

https://elixirschool.com/jp/lessons/basics/basics/#ã‚¢ãƒˆãƒ 

- Ruby ã§ã„ã† `ã‚·ãƒ³ãƒœãƒ«` ã‚‰ã—ã„
- è‡ªèº«ã®åå‰ãŒãã®ã¾ã¾å€¤ã«ãªã‚‹å®šæ•°

___

### ğŸ™‚
```
iex> :foo
:foo
```
___

### ğŸ˜€
```
iex> :foo == :foo
true
```

___

### ğŸ˜¶
```
iex> :foo == "foo"
false
```

___

### ğŸ˜®
```
iex> :foo == ":foo"
false
```

___

### ğŸ˜–
```
iex(19)> :foo == foo
** (CompileError) iex:19: undefined function foo/0
    (stdlib) lists.erl:1354: :lists.mapfoldl/3
    (stdlib) lists.erl:1355: :lists.mapfoldl/3
```

---

# Webé–‹ç™º

___

## Phoenix

http://phoenixframework.org/

___

### install

```
mix archive.install https://github.com/phoenixframework/archives/raw/master/phx_new.ez
```

- ã“ã“ã§ã‚‚ `mix`

___

### scaffold

```
mix phx.new hello_world --no-ecto
```

- `ecto` ã¯ DB ã‚’ä½¿ã†ã‚„ã¤
- ã“ã“ã§ã¯å¤–ã—ã¦ãŠã
    - å‹•ã‹ã›ãªã‹ã£ãŸã¨ã‚‚è¨€ã†
- é€”ä¸­ã§ä¾å­˜ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã‚’å…¥ã‚Œã‚‹ã‹è¨Šã„ã¦ãã‚Œã‚‹

___

### èµ·å‹•
```
cd hello_world
mix phx.server
```

- ã‚¦ã‚§ãƒ–ã‚µãƒ¼ãƒãƒ¼ãŒ `localhost:4000` ã§ç«‹ã¡ä¸ŠãŒã‚‹

---

## ãƒšãƒ¼ã‚¸ã‚’è¿½åŠ ã—ã¦ã¿ã‚‹

___

### å¤‰æ›´ã€è¿½åŠ ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«

- ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
- ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
- ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

___

### ãƒ«ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
lib/hello_world_web/router.ex

```
scope "/", HelloWorldWeb do
  pipe_through :browser # Use the default browser stack

  get "/", PageController, :index
  get "/hello/:name", PageController, :hello # ã“ã®è¡Œã‚’è¿½åŠ 
end
```

___

#### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼
lib/hello_world_web/controllers/page_controller.ex

```
# ã“ã®é–¢æ•°ã‚’è¿½åŠ 
def hello(conn, %{"name" => name}) do
  render conn, "hello.html", name: name
end
```

___

#### ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ
lib/hello_world_web/templates/page/hello.html.eex

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 

```
<div class="jumbotron">
  <h2>Hello World, from <%= @name %>!</h2>
</div>
```

___

### ã‚¢ã‚¯ã‚»ã‚¹ã—ã¦ã¿ã‚‹

- http://localhost:4000/hello/nqounet
- http://localhost:4000/hello/è‹¥æ—
- http://localhost:4000/hello/%3Cscript%3E

___

ã ã„ãŸã„ãã‚“ãªæ„Ÿã˜

---

# ã“ã“ã¾ã§ã®æ„Ÿæƒ³

___

ã ã„ãŸã„ãã‚“ãªæ„Ÿã˜

---

# Questions?

---

# Thanks!
https://twitter.com/nqounet
